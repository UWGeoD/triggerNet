# triggerNet

A Python pipeline for unsupervised clustering of earthquake or acoustic emission (AE) catalogs using nearest-neighbor distance (NND) analysis.  
Automatically detects event clusters, computes key statistics, and generates summary plots—supporting both research and exploratory data analysis.

**Author:** Ellie Johnson

---

## Table of Contents

- [Features](#features)
- [Installation](#installation)
- [Quick Start](#quick-start)
- [Usage](#usage)
- [Repository Structure](#repository-structure)
- [Example](#example)
- [Contributing](#contributing)
- [License](#license)
- [Citation](#citation)

---

## Features

- **Flexible Input:** Works with CSV or MATLAB (.mat) catalogs.
- **Robust Parameterization:** Auto-estimates or uses user-provided b-value, fractal dimension, and other clustering parameters.
- **Cluster Extraction:** Builds a spanning tree and extracts cluster forests via thresholding.
- **Diagnostic Plots:** Generates histograms and contour plots comparing original vs. randomized catalogs.
- **Modular Design:** Core logic is cleanly separated for easy extension.
- **CLI Ready:** All paths and parameters are configurable via command line.

---

## Installation

Requires **Python 3.8+**

### 1. Clone the Repository

```bash
git clone https://github.com/yourusername/triggerNet.git
cd triggerNet
````

### 2. Install Dependencies

**Recommended:** Use a virtual environment.

```bash
python -m venv venv
source venv/bin/activate
```

**Install dependencies:**

```bash
pip install -r requirements.txt
```

Or, with Conda:

```bash
conda env create -f environment.yml
conda activate triggerNet
```

---

## Quick Start

```bash
python src/main.py \
  -i data/example_catalog.csv \
  -o results/demo \
  --mag_col magnitude \
  --x_col longitude \
  --y_col latitude
```

* See `data/example_catalog.csv` for input format.
* Results and plots will appear in `/results` and `/plots` directories.

---

## Usage

**Command-Line Options:**

| Flag                    | Description                                   | Default    |
| ----------------------- | --------------------------------------------- | ---------- |
| `-i`, `--input`         | Path to input catalog (`.csv` or `.mat`)      | *required* |
| `-o`, `--output_prefix` | Prefix for output files                       | `results`  |
| `--time_col`            | Name of time column in input                  | `time`     |
| `--x_col`               | Name of x (lon/lat) column                    | `x`        |
| `--y_col`               | Name of y (lat/lon) column                    | `y`        |
| `--z_col`               | Name of depth/z column (optional)             | None       |
| `--mag_col`             | Name of magnitude column                      | `mag`      |
| `--time_format`         | Datetime parsing format (for CSV)             | None       |
| `--mag_cutoff`          | Minimum magnitude to include                  | None       |
| `--q`                   | Normalization exponent Q                      | `0.5`      |
| `--b`                   | b-value (auto-estimated if not set)           | None       |
| `--df`                  | Fractal dimension (auto-estimated if not set) | None       |
| `--eta0`                | Threshold for strong links (auto-estimated)   | None       |

*Example:*

```bash
python src/main.py -i data/example_catalog.csv -o demo --mag_cutoff 2.0
```

**Outputs:**

* `results/<prefix>_nnd.csv`: Catalog with NND and parent assignments.
* `results/<prefix>_tree.csv`: Spanning tree edges.
* `results/<prefix>_adjacency.csv`: Strong-link adjacency matrix.
* `results/<prefix>_clusters.txt`: List of clusters (components).
* `plots/<prefix>_hist.png`: Histogram of log₁₀(η).
* `plots/<prefix>_overlaid.png`: Contour plot (original vs shuffled).
* `plots/<prefix>_combined.png`: Combined contour plot.

---

## Repository Structure

```
triggerNet/
├── src/
│   ├── main.py
│   ├── config.py
│   ├── data_io.py
│   ├── analysis.py
│   ├── clustering.py
│   └── utils.py
├── data/
│   └── example_catalog.csv
├── plots/
├── results/
├── tests/
│   └── test_clustering.py
├── examples/
│   └── demo_pipeline.ipynb
├── README.md
├── LICENSE
├── requirements.txt
├── .gitignore
├── CONTRIBUTING.md
└── CODE_OF_CONDUCT.md
```

* **src/**: Source code (main pipeline, analysis, clustering, utilities)
* **data/**: Example input catalogs (tiny, non-proprietary)
* **plots/**: Output plots (autogenerated)
* **results/**: Output CSVs (autogenerated)
* **tests/**: Minimal tests and validation scripts
* **examples/**: Usage notebooks or advanced examples

---

## Example

* **Minimal catalog:** See `data/example_catalog.csv`
* **Demo notebook:** See `examples/demo_pipeline.ipynb` for a step-by-step walk-through.

---

## Contributing

Contributions are welcome!
See [CONTRIBUTING.md](CONTRIBUTING.md) for how to file issues, contribute code, or suggest enhancements.
Please read and respect the [CODE\_OF\_CONDUCT.md](CODE_OF_CONDUCT.md).

---

## License

This project is licensed under the [MIT License](LICENSE).

---

## Citation

If you use this pipeline in academic work, please cite as:

```
@software{johnson2024triggerNet,
  author    = {Ellie Johnson},
  title     = {triggerNet: Nearest-Neighbor Earthquake Clustering Pipeline},
  year      = {2024},
  url       = {https://github.com/UWGeoD/triggerNet},
  version   = {v1.0.0},
}
```

---

**Questions?**
Open an [issue](https://github.com/UWGeoD/triggerNet/issues) or email the maintainer!
